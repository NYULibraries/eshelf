machine:
  ruby:
    version: jruby-9.1.7.0

  java:
    version: openjdk7

  environment:
    ESHELF_DB_USER: root
    JAVA_OPTS: '-Xmx512m -XX:MaxPermSize=512m'

dependencies:
  post:
    - npm install -g istanbul

test:
  override:
    - COVERALLS_REPO_TOKEN=$COVERALLS_REPO_TOKEN RAILS_ENV=test bundle exec rspec -r rspec_junit_formatter --format progress --format RspecJunitFormatter -o $CIRCLE_TEST_REPORTS/rspec/junit.xml
    - mkdir -p $CIRCLE_TEST_REPORTS/cucumber
    - bundle exec cucumber --format pretty --format json --out $CIRCLE_TEST_REPORTS/cucumber/tests.cucumber
  post:
    - bundle exec rake teaspoon
    - JRUBY_OPTS=--debug bundle exec rake coveralls:push 
## Customize database setup
database:
  override:
    - mysql -e 'create database eshelf_test;'
    - bundle exec rake db:schema:load RAILS_ENV=test
