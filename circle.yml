machine:

  ruby:
    version: 2.3.3

  environment:
    ESHELF_DB_USER: root
    PRIMO_BASE_URL: http://primo.library.edu

dependencies:
  post:
    - npm install -g istanbul

test:
  override:
    - RAILS_ENV=test bundle exec rspec
    - mkdir -p $CIRCLE_TEST_REPORTS/cucumber
    - RAILS_ENV=test bundle exec cucumber --format pretty --format json --out $CIRCLE_TEST_REPORTS/cucumber/tests.cucumber
    - RAILS_ENV=test bundle exec rake test
  post:
    - bundle exec rake teaspoon
    - bundle exec rake coveralls:push
## Customize database setup
database:
  override:
    - mysql -e 'create database eshelf_test;'
    - bundle exec rake db:schema:load RAILS_ENV=test

deployment:
  # production:
  #   branch: master
  #   # owner: NYULibraries
  #   commands:
  #     - curl -u $JENKINS_USERNAME:$JENKINS_API_KEY -X POST http://jenkins.library.nyu.edu/view/E-Shelf/job/Eshelf%20Production%20Deploy/build/api
  qa:
    branch: qa
    # owner: NYULibraries
    commands:
      - curl -u $JENKINS_USERNAME:$JENKINS_API_KEY -X POST http://jenkins.library.nyu.edu/view/E-Shelf/job/EShelf%20QA%20Deploy/build/api
  development:
    branch: /.+/
    # owner: NYULibraries
    commands:
      - curl -u $JENKINS_USERNAME:$JENKINS_API_KEY -X POST http://jenkins.library.nyu.edu/view/E-Shelf/job/Eshelf%20Development%20Deploy/build/api
